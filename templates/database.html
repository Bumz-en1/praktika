<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <a href="/" class="nav-button">
                <span>üè†</span>
                –ì–ª–∞–≤–Ω–∞—è
            </a>
            <a href="/add" class="nav-button">
                <span>‚ûï</span>
                –î–æ–±–∞–≤–∏—Ç—å
            </a>
            <a href="/database" class="nav-button active">
                <span>üóÑÔ∏è</span>
                –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
            </a>
            <a href="/users" class="nav-button">
                <span>üë•</span>
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </a>
        </div>
        <div class="nav-right">
            <a href="/profile" class="nav-button">
                <span>üë§</span>
                –ü—Ä–æ—Ñ–∏–ª—å
            </a>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">üåô</span>
            </button>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ª–∏—Ü</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª–∏—Ü</p>
            <a href="/add" class="btn btn-primary">
                <span>‚ûï</span>
                –î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
            </a>
        </div>

        <div class="database-controls">
            <div class="search-section">
                <div class="search-group">
                    <input type="text" id="searchInput" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ ID...">
                    <button onclick="searchPersons()" class="btn btn-primary">üîç –ù–∞–π—Ç–∏</button>
                    <button onclick="clearSearch()" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="pagination-controls">
                <div class="records-per-page">
                    <label for="recordsPerPage">–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                    <select id="recordsPerPage" class="form-select" onchange="changeRecordsPerPage()">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <div class="pagination-info">
                    <span id="paginationInfo">–ü–æ–∫–∞–∑–∞–Ω–æ 1-{{ persons|length }} –∏–∑ {{ persons|length }} –∑–∞–ø–∏—Å–µ–π</span>
                </div>
                
                <div class="pagination-buttons">
                    <button id="prevBtn" onclick="previousPage()" class="btn btn-secondary" disabled>‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                    <span id="pageNumbers"></span>
                    <button id="nextBtn" onclick="nextPage()" class="btn btn-secondary">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
                </div>
            </div>
        </div>

        <div class="database-stats">
            <div class="stat-card">
                <div class="stat-number" id="totalRecords">{{ persons|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="filteredRecords">{{ persons|length }}</div>
                <div class="stat-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è</div>
            </div>
        </div>

        <div class="database-grid" id="databaseGrid">
            {% for person in persons %}
            <div class="person-card" data-name="{{ person.name|lower }}" data-id="{{ person.id }}">
                <div class="person-photo">
                    <img src="{{ person.photo_path }}" alt="{{ person.name }}" onerror="this.src='/static/default_avatar.png'">
                </div>
                <div class="person-info">
                    <h3>{{ person.name }}</h3>
                    <p class="person-gender">{{ person.gender }}</p>
                    <p class="person-id">ID: {{ person.id }}</p>
                </div>
                <div class="person-actions">
                    <button class="btn btn-sm btn-danger" onclick="deletePerson('{{ person.id }}')">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if not persons %}
        <div class="empty-state">
            <div class="empty-icon">üóÑÔ∏è</div>
            <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</p>
            <a href="/add" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</a>
        </div>
        {% endif %}

        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
        <div id="emptySearchState" class="empty-state" style="display: none;">
            <div class="empty-icon">üîç</div>
            <h2>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
            <button onclick="clearSearch()" class="btn btn-primary">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫</button>
        </div>
    </div>

    <script src="/static/script.js"></script>
    <script>
function deletePerson(personId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?')) {
        fetch(`/delete-person/${personId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
            }
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
        });
    }
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞
let currentPage = 1;
let recordsPerPage = 50;
let allPersonCards = [];
let filteredPersonCards = [];

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω
    allPersonCards = Array.from(document.querySelectorAll('.person-card'));
    filteredPersonCards = [...allPersonCards];
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    updateDisplay();
});

function searchPersons() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    
    if (searchTerm === '') {
        filteredPersonCards = [...allPersonCards];
    } else {
        filteredPersonCards = allPersonCards.filter(card => {
            const name = card.getAttribute('data-name') || '';
            const id = card.getAttribute('data-id') || '';
            return name.includes(searchTerm) || id.includes(searchTerm);
        });
    }
    
    currentPage = 1;
    updateDisplay();
}

function clearSearch() {
    document.getElementById('searchInput').value = '';
    filteredPersonCards = [...allPersonCards];
    currentPage = 1;
    updateDisplay();
}

function changeRecordsPerPage() {
    recordsPerPage = parseInt(document.getElementById('recordsPerPage').value);
    currentPage = 1;
    updateDisplay();
}

function previousPage() {
    if (currentPage > 1) {
        currentPage--;
        updateDisplay();
    }
}

function nextPage() {
    const totalPages = Math.ceil(filteredPersonCards.length / recordsPerPage);
    if (currentPage < totalPages) {
        currentPage++;
        updateDisplay();
    }
}

function goToPage(page) {
    currentPage = page;
    updateDisplay();
}

function updateDisplay() {
    const startIndex = (currentPage - 1) * recordsPerPage;
    const endIndex = startIndex + recordsPerPage;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    allPersonCards.forEach(card => {
        card.style.display = 'none';
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
    const currentPageCards = filteredPersonCards.slice(startIndex, endIndex);
    currentPageCards.forEach(card => {
        card.style.display = 'block';
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    const totalPages = Math.ceil(filteredPersonCards.length / recordsPerPage);
    const showingStart = filteredPersonCards.length > 0 ? startIndex + 1 : 0;
    const showingEnd = Math.min(endIndex, filteredPersonCards.length);
    
    document.getElementById('paginationInfo').textContent = 
        `–ü–æ–∫–∞–∑–∞–Ω–æ ${showingStart}-${showingEnd} –∏–∑ ${filteredPersonCards.length} –∑–∞–ø–∏—Å–µ–π`;
    
    document.getElementById('filteredRecords').textContent = filteredPersonCards.length;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    document.getElementById('prevBtn').disabled = currentPage === 1;
    document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
    updatePageNumbers(totalPages);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const emptyState = document.getElementById('emptySearchState');
    if (filteredPersonCards.length === 0 && allPersonCards.length > 0) {
        emptyState.style.display = 'block';
    } else {
        emptyState.style.display = 'none';
    }
}

function updatePageNumbers(totalPages) {
    const pageNumbers = document.getElementById('pageNumbers');
    pageNumbers.innerHTML = '';
    
    if (totalPages <= 1) return;
    
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-secondary'}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => goToPage(i);
        pageNumbers.appendChild(pageBtn);
    }
}

// –ü–æ–∏—Å–∫ –ø–æ Enter
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchPersons();
    }
});

// –ü–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
let searchTimeout;
document.getElementById('searchInput').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(searchPersons, 300);
});
</script>
</body>
</html>
