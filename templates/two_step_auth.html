<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card twofa-card">
            <div class="auth-header">
                <div class="twofa-illustration">
                    <div class="phone-icon">
                        <span>üì±</span>
                    </div>
                    <div class="telegram-logo">
                        <span>‚úàÔ∏è</span>
                    </div>
                </div>
                <h1>–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h1>
                <p>–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –≤–∞—à Telegram</p>
                <p style="color:red;">DEBUG: –í—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ {{ request.url }}</p>
            </div>

            {% if error %}
            <div class="alert alert-error">
                {{ error }}
            </div>
            {% endif %}

            <form class="auth-form twofa-form" action="/verify_2fa" method="post">
                <div class="form-group">
                    <label for="code">–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥:</label>
                    <input type="text" id="code" name="code" class="form-input code-input" maxlength="6" placeholder="000000" required autofocus>
                    <small class="form-hint">–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–∏–Ω—É—Ç</small>
                </div>

                <button type="submit" class="submit-btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥</button>
            </form>

            <div class="twofa-help">
                <div class="help-item">
                    <span class="help-icon">‚ùì</span>
                    <div class="help-text">
                        <strong>–ù–µ –ø–æ–ª—É—á–∏–ª–∏ –∫–æ–¥?</strong>
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üîí</span>
                    <div class="help-text">
                        <strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</strong>
                        <p>–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–≥–∏–º –ª—é–¥—è–º</p>
                    </div>
                </div>
            </div>

            <div class="auth-footer">
                <a href="/login">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É</a>
            </div>
        </div>

        <button class="theme-toggle floating" onclick="toggleTheme()">
            <span id="theme-icon">üåô</span>
        </button>
    </div>

    <script>
// Theme Management
function initTheme() {
    const savedTheme = localStorage.getItem("theme") || "light"
    document.documentElement.setAttribute("data-theme", savedTheme)
    updateThemeIcon(savedTheme)
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute("data-theme")
    const newTheme = currentTheme === "dark" ? "light" : "dark"

    document.documentElement.setAttribute("data-theme", newTheme)
    localStorage.setItem("theme", newTheme)
    updateThemeIcon(newTheme)
}

function updateThemeIcon(theme) {
    const icon = document.getElementById("theme-icon")
    if (icon) {
        icon.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô"
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
document.getElementById('code').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 6) value = value.slice(0, 6);
    e.target.value = value;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ 6 —Ü–∏—Ñ—Ä
    if (value.length === 6) {
        setTimeout(() => {
            document.querySelector('.twofa-form').submit();
        }, 500);
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞
document.getElementById('code').addEventListener('paste', function(e) {
    e.preventDefault();
    let paste = (e.clipboardData || window.clipboardData).getData('text');
    let code = paste.replace(/\D/g, '').slice(0, 6);
    this.value = code;
    
    if (code.length === 6) {
        setTimeout(() => {
            document.querySelector('.twofa-form').submit();
        }, 500);
    }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
document.addEventListener("DOMContentLoaded", () => {
    initTheme()
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('code').focus();
});

// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener("DOMContentLoaded", () => {
    const card = document.querySelector('.twofa-card');
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        card.style.transition = 'all 0.5s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
    }, 100);
});
</script>
</body>
</html>
